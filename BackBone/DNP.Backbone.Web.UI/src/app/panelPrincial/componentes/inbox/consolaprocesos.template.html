<div class="dashboard">

    <div id="proyectos" class="project">
        <div class="row">
            <div class="col-md-12">
                <div class="titlebar">
                    <span>Consola de procesos </span>
                    <!--<span class="buttonbar pull-right">
                <button type="button" class="btn btn-default btn-md btnFiltroHeader" tooltip-placement="top" uib-tooltip="Adicionar Columna" ng-click="vm.abrirModalAdicionarColumnas()" tabindex="0">
                    Adicionar columna
                </button>
                <button type="button" class="btn btn-default btn-md btnFiltroHeader" ng-click="vm.conmutadorFiltro()" tooltip-placement="auto" uib-tooltip="Filtro">Filtro</i></button>
                <a href="" download target="_blank" class="btn btn-default btn-md btnFiltroHeader btnRedondo" ng-click="vm.downloadPdf()" tooltip-placement="auto" uib-tooltip="Exportar PDF">
                    PDF
                </a>
                <a href="" download target="_blank" class="btn btn-default btn-md btnFiltroHeader btnRedondo" ng-click="vm.downloadExcel()" tooltip-placement="auto" uib-tooltip="Exportar XLS">
                    XLS
                </a>-->
                    <!-- <a href="{{vm.obtenerXML}}" download target="_blank" tooltip-placement="top" uib-tooltip="Exportar XML"><img src="/Img/btn/btnExportXML.png" alt="XML" /></a> -->
                    <!--</span>-->
                </div>
            </div>
        </div>

        <!--<div class="row">
        <div class="col-md-12">

            <div class="btn-group btn-group-toggle btnsFiltrosAgrupados" data-toggle="buttons">
                <label class="btn btn-secondary active">
                    <a>Proyectos</a>
                </label>
                <label class="btn btn-secondary">
                    <a href="/consolaprocesos/tramites">Trámites</a>
                </label>
            </div>
        </div>
    </div>-->
        <div class="content-macroprocesos-consola">
            <div class="accion-seleccionada">
                <a href="/consolaprocesos/proyectos">
                    <div class="div-accion-seleccionada">
                        <label style="position: absolute; top: 50%; left: 50%; cursor: pointer; transform: translate(-50%, -50%)">Proyectos</label>
                    </div>
                </a>
            </div>
            <div class="accion-sin-seleccion" style="left:130px">
                <a href="/consolaprocesos/tramites">
                    <div class="div-accion-sin-seleccion">
                        <label style="position: absolute; top: 50%; left: 50%; cursor:pointer; transform: translate(-50%, -50%)">Trámites</label>
                    </div>
                </a>
            </div>
            <div class="accion-sin-seleccion" style="left:240px">
                <a href="/consolaprocesos/programacion">
                    <div class="div-accion-sin-seleccion">
                        <label style="position: absolute; top: 50%; left: 50%; cursor:pointer; transform: translate(-50%, -50%)">Programación</label>
                    </div>
                </a>
            </div>

        </div>

        <!--inicio tabs-->
        <div class="form-group clearfix">
            <div class="row">
                <div class="col-sm-12 tabs radio radio-primary">
                    <ul class="nav nav-tabs tabsFiltro">
                        <li tabindex="0" class="{{$index == 0 ? 'active' : ''}}" ng-repeat="tipo in vm.listaTipoEntidad">
                            <a data-toggle="tab" ng-click="vm.cambioTipoEntidad(tipo.Nombre)" ng-disabled="{{tipo.Deshabilitado}}" ng-if="!tipo.Deshabilitado"
                               llamar-funcion-con-tecla="vm.cambioTipoEntidad(tipo.Nombre)">
                                {{tipo.Descripcion}}
                            </a>
                            <a ng-if="tipo.Deshabilitado" class="disabled" disabled>{{tipo.Descripcion}}</a>
                        </li>

                    </ul>
                </div>
            </div>
            <div class="row">
                <div class="col-md-12">
                    <div class="col-md-6">
                        <p class="mis-procesos-titulo-totales">Proyectos / {{vm.tipoEntidad}}. Total: {{ vm.cantidadDeProyectos }}</p>
                    </div>
                    <div class="row rowbotonesicoDNP">

                        <div class="col-md-12 text-right nopadding">
                            <button class="btnaccion" tooltip-class="customClass" uib-tooltip="Limpiar" ng-click="vm.restablecerBusqueda()">
                                <span> <img id="icoLimpiarBusqueda" class="icoBusquedasDNP" src="Img/IcolimpiarBusqD.svg"></span>
                            </button>
                            <button tooltip-class="customClass" uib-tooltip="Buscar" class="btnicobuscarDNP" type="button" data-toggle="collapse" data-target="#IdPanelBuscador" ng-click="vm.conmutadorFiltro()">
                                <span> <img id="arrow-IdPanelBuscador" class="icoBusquedas2DNP glyphicon-chevron-up-busqDNP" src="Img/IcoBusqDow.svg" data-target="#IdPanelBuscador"></span>
                            </button>
                            <button class="btnaccion" ng-click="vm.downloadPdf()">
                                <span> <img class="icoBusquedasDNP" src="Img/etapas/u1089.svg"></span>
                            </button>
                            <button class="btnaccion" ng-click="vm.downloadExcel()">
                                <span> <img class="icoBusquedasDNP" src="Img/etapas/u1090.svg"></span>
                            </button>
                        </div>
                    </div>
                    <!--<span class="buttonbar pull-right">
                    <img src="Img/etapas/u702.svg" class="imgMisProcesosAcciones" ng-click="vm.conmutadorFiltro()" uib-tooltip="Filtro" />
                    <img src="Img/etapas/u1089.svg" class="imgMisProcesosAcciones" ng-click="vm.downloadPdf()" uib-tooltip="Exportar PDF" />
                    <img src="Img/etapas/u1090.svg" class="imgMisProcesosAcciones" ng-click="vm.downloadExcel()" uib-tooltip="Exportar XLS" />
                </span>-->
                </div>
            </div>

            <!--inicio filtro-->
            <br />
            <div class="row panelbuscadorDNP" id="IdPanelBuscador">

                <div class="row">
                    <div ng-if="vm.tipoEntidad === 'Nacional'">
                        <div class="col-md-4">
                            <div class="labelbuscadorDNP"> <span>Sector proyecto</span></div>
                            <select class="form-control selectDNP" ng-model="vm.proyectoFiltro.sectorId" ng-change="vm.listarFiltroEntidadesProyecto()"
                                    ng-options="x.Id as x.Name for x in vm.listaFiltroSectores" name="ddlSector" id="ddlSector">
                                <option value="" selected>Seleccione...</option>
                            </select>
                        </div>
                        <div class="col-md-5 SelectBuscadorDNP">
                            <div class="labelbuscadorDNP"> <span>Entidad</span></div>
                            <select class="form-control selectDNP" chosen options="vm.ListaEntidadesProyectos" ng-model="vm.proyectoFiltro.entidadProyectoId"
                                    ng-options="x.Id as x.Nombre for x in vm.ListaEntidadesProyectos" name="ddlEntidadProyecto" id="ddlEntidadProyecto" no-results-text="No hay ningún resultado para su búsqueda"
                                    placeholder-text-single="Entidades">
                                <option value="" selected>Seleccione...</option>
                            </select>
                        </div>
                    </div>
                    <div ng-if="vm.tipoEntidad !== 'Nacional'">
                        <div class="col-md-5 SelectBuscadorDNP">
                            <div class="labelbuscadorDNP"> <span>Entidad</span></div>
                            <select class="form-control selectDNP" chosen options="vm.ListaEntidadesProyectos" ng-model="vm.proyectoFiltro.entidadProyectoId"
                                    ng-options="x.Id as x.Nombre for x in vm.ListaEntidadesProyectos" name="ddlEntidadProyecto" id="ddlEntidadProyecto" no-results-text="No hay ningún resultado para su búsqueda"
                                    placeholder-text-single="Entidades">
                                <option value="" selected>Seleccione...</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <div class="labelbuscadorDNP"> <span>Sector proyecto</span></div>
                            <select class="form-control selectDNP" ng-model="vm.proyectoFiltro.sectorId" ng-change="vm.listarFiltroEntidadesProyecto()"
                                    ng-options="x.Id as x.Name for x in vm.listaFiltroSectores" name="ddlSector" id="ddlSector">
                                <option value="" selected>Seleccione...</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="labelbuscadorDNP"> <span>Vigencia</span></div>
                        <select class="form-control selectDNP" ng-model="vm.proyectoFiltro.vigencia"
                                ng-options="x as x for x in vm.listaFiltroVigencias" name="ddlVigenciasProyecto" id="ddlVigenciasProyecto">
                            <option value="" selected>Seleccione...</option>
                        </select>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-1">
                        <div class="labelbuscadorDNP"> <span>ID-MGA </span></div>
                        <input type="text" ng-model="vm.proyectoFiltro.identificador" name="txtIdentificador"
                               id="txtIdentificador" class="form-control InputBuscadorDNP" />
                    </div>
                    <div class="col-md-2">
                        <div class="labelbuscadorDNP"> <span>BPIN</span></div>
                        <input type="text" class="form-control InputBuscadorDNP" ng-model="vm.proyectoFiltro.bpin" numbers-only name="txtBpin" id="txtBpin" />
                    </div>
                    <div class="col-md-6">
                        <div class="labelbuscadorDNP"> <span>Nombre del proyecto</span></div>
                        <input type="text" class="form-control InputBuscadorDNP" placeholder="Escriba palabra o frase" ng-model="vm.proyectoFiltro.nombre" name="txtNombreFlujo"
                               id="txtNombreFlujo" />
                    </div>

                    <div class="col-md-3">
                        <div class="labelbuscadorDNP"> <span>Estado proyecto</span></div>
                        <select class="form-control selectDNP" ng-model="vm.proyectoFiltro.estadoProyectoId"
                                ng-options="x.Id as x.Estado for x in vm.listaFiltroEstadoProyectos"
                                name="ddlEstadoDelProyecto" id="ddlEstadoDelProyecto">
                            <option value="" selected>Seleccione...</option>
                        </select>
                    </div>
                </div>
                <div class="" style="height:20px">
                </div>
                <div class="row">
                    <div class="col-md-2">
                        <div class="labelbuscadorDNP"> <span>Estado subproceso</span></div>
                        <select class="form-control selectDNP" ng-model="vm.proyectoFiltro.estadoInstanciaId"
                                ng-options="x.Id as x.Estado for x in vm.listaFiltroEstadoInstancias"
                                name="ddlEstadoSubproceso" id="ddlEstadoSubproceso">
                            <option value="" selected>Seleccione...</option>
                        </select>
                    </div>
                    <div class="col-md-2">
                        <div class="labelbuscadorDNP"> <span>Código proceso</span></div>
                        <input type="text" class="form-control InputBuscadorDNP" ng-model="vm.proyectoFiltro.codigoProceso" name="txtCodigoProceso" id="txtCodigoProceso" />
                    </div>
                    <div class="col-md-2">
                        <div class="labelbuscadorDNP"> <span>Subproceso</span></div>
                        <select class="form-control selectDNP" ng-model="vm.proyectoFiltro.flujoId" ng-change="vm.listarFiltroAcciones()"
                                ng-options="x.Id as x.Nombre for x in vm.listaFiltroFlujos"
                                name="ddlEstadoDelProyecto" id="ddlEstadoDelProyecto">
                            <option value="" selected>Seleccione...</option>
                        </select>
                    </div>
                    <div class="col-md-2">
                        <div class="labelbuscadorDNP"> <span>Paso actual</span></div>
                        <select class="form-control selectDNP" ng-model="vm.proyectoFiltro.accionId"
                                ng-options="x.Id as x.Nombre for x in vm.listaFiltroAccion"
                                name="ddlPasoActual" id="ddlPasoActual">
                            <option value="" selected>Seleccione...</option>
                        </select>
                    </div>
                    <div class="col-md-4 SelectBuscadorDNP">
                        <div class="labelbuscadorDNP"> <span>Entidad encargada de paso actual</span></div>
                        <select class="form-control selectDNP" chosen options="vm.listaFiltroEntidades" ng-model="vm.proyectoFiltro.entidadId"
                                ng-options="x.EntityTypeCatalogOptionId as x.Nombre for x in vm.listaFiltroEntidades" name="ddlEntidad" id="ddlEntidad" no-results-text="No hay ningún resultado para su búsqueda"
                                placeholder-text-single="Entidades">
                            <option value="" selected>Seleccione...</option>
                        </select>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6 pull-left text-left" ng-if="vm.BusquedaRealizada">
                        <span class="spanresultadobusquedaDNP pull-left" ng-if="vm.cantidadDeProyectos > 0">
                            Se encontraron ({{vm.cantidadDeProyectos}}) resultados.
                        </span>
                        <span class="spanresultadobusqueda2DNP pull-left" style="margin-top: 0px;" ng-if="vm.cantidadDeProyectos == 0">
                            No se encontraron resultados.
                        </span>
                    </div>
                    <div class="col-md-6 pull-right text-right">
                        <span class="pull-right">
                            <button type="button" class=" btnBuscarDNP " tooltip-class="customClass" uib-tooltip="Buscar" ng-click="vm.buscar()">
                                BUSCAR
                            </button>
                        </span>
                    </div>
                </div>
            </div>

            <!--Inicio Nueva Grilla-->
            <div class="row">
                <div class="" style="padding: 0 !important" ng-repeat="entidad in vm.listaEntidades | orderBy:'sector'">
                    <div class="alert panel-headingAccDNP">
                        <div class="card card-body pull-left  divAccordionDNP">
                            <span class="uLabelCampo">{{entidad.sector}}</span> - {{entidad.entidad}}
                            <p class="panelbtnalertAcordnp">
                                <button class="btnaccion btnAccordionDNP" type="button" data-toggle="collapse" data-target="#obj_{{entidad.idEntidad}}" ng-click="vm.AbrilNivel(entidad.idEntidad)">
                                    <img ng-show="entidad.estadoEntidad == '+'" src="Img/btnMas.svg">
                                    <img ng-show="entidad.estadoEntidad == '-'" src="Img/btnMenos.svg">
                                </button>
                            </p>
                        </div>
                    </div>
                    <br />
                    <div class="collapse" id="obj_{{entidad.idEntidad}}" style="margin-top: -20px;">
                        <div class="LineaEncabezadodivDNP"></div>
                        <div class="row">
                            <h3 class="tituloEncabezadodivDNP">
                                Proyectos: {{entidad.subGridOptions.data.length}}
                            </h3>
                        </div>

                        <div class="row" style="margin: 0px 0px 0px 0px;">
                            <div class="col-md-12 ">

                                <table class="TableDNP">
                                    <thead>
                                        <tr>
                                            <th class="columAcc"></th>
                                            <th class="textLeftDNP">ID / BPIN / Estado / Sector</th>
                                            <th class="textLeftDNP">Nombre del proyecto</th>
                                            <th class="textLeftDNP">Proceso / Sub proceso / Código proceso / Estado / Fecha inicio / Fecha fin</th>
                                            <th class="textLeftDNP">Paso actual / Fecha inicio / Fecha fin</th>
                                            <th class="columAcc"></th>
                                            <th class="columAcc"></th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr ng-repeat="datos in entidad.subGridOptions.data | orderBy:'-FechaCreacion'">
                                            <td></td>
                                            <td class="textLeftDNP">
                                                <p style="margin:0">{{datos.ProyectoId}}</p>
                                                <p style="margin:0; font-weight:600">{{datos.IdObjetoNegocio}}</p>
                                                <p style="margin:0">{{datos.EstadoProyecto}}</p>
                                                <p style="margin: 0; font-weight:600">{{datos.SectorNombre}}</p>
                                            </td>
                                            <td class="textLeftDNP">{{datos.NombreObjetoNegocio}}</td>
                                            <td class="textLeftDNP">
                                                <p style=" margin: 0">{{datos.Macroproceso}}</p>
                                                <a style="margin: 0; font-weight: 600" href="#" ng-click="vm.consultarAccion(datos.IdInstancia, datos.NombreObjetoNegocio, datos.IdObjetoNegocio, datos.IdEntidad, datos.NombreFlujo, datos)">
                                                    {{datos.NombreFlujo}}
                                                </a>
                                                <p style="margin: 0">
                                                    {{datos.CodigoProceso}}
                                                </p>
                                                <p style="margin: 0; font-weight: 600">{{datos.EstadoInstancia}}</p>
                                                <p style="margin: 0">Fecha inicio: {{datos.FechaCreacion | date:'dd-MM-yyyy HH:mm:ss'}}</p>
                                                <p ng-if="datos.FechaFin.length > 0" style="margin: 0">Fecha fin: {{datos.FechaFin | date:'dd-MM-yyyy HH:mm:ss'}}</p>
                                                <a href="#" style="font-weight:600" ng-click="vm.consultarAccion(datos.InstanciaPadreId, datos.NombreObjetoNegocio, datos.CodigoTramite, datos.IdEntidad, null, datos)">
                                                    {{datos.CodigoTramite}}
                                                </a>
                                            </td>
                                            <td class="textLeftDNP">
                                                <p style="margin: 0">{{datos.NombreAccion}}</p>
                                                <p style="margin: 0; font-weight:600">Fecha inicio paso: {{datos.FechaPaso | date:'dd-MM-yyyy HH:mm:ss'}}</p>
                                                <p ng-if="datos.FechaFinPaso.length > 0" style="margin: 0; font-weight:600">Fecha fin paso: {{datos.FechaFinPaso | date:'dd-MM-yyyy HH:mm:ss'}}</p>
                                                <p style="margin: 0">{{datos.NombreEntidadDestino}}</p>
                                            </td>
                                            <td class="textCenterDNP">
                                                <button class="btnaccion" tooltip-class="customClass" uib-tooltip="Ver historial">
                                                    <img src="Img/etapas/u1760.svg" uib-tooltip="Ver historial" ng-click="vm.abrirLogInstancias(datos)" />
                                                </button>
                                            </td>
                                            <td class="textCenterDNP">
                                                <button class="btnaccion" tooltip-class="customClass" uib-tooltip="Eliminar" ng-click="vm.detenerInstancia(datos)">
                                                    <img src="Img/etapas/u1756.svg" />
                                                </button>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>

                            </div>
                        </div>
                    </div>

                </div>
            </div>
            <!--Fin Nueva Grilla-->

        </div>

    </div>
    <link href="/Content/ui-gridConsolaDNP.css" rel="stylesheet" />
